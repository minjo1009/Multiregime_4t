name: 4t-backtest

on:
  workflow_dispatch:

jobs:
  backtest:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repo
      uses: actions/checkout@f43a0e5ff2bd294095638e18286ca9a3d1956744  # pinned SHA

    - name: Set up Python
      uses: actions/setup-python@82c7e631bb3cdc910f68e0081d67478d79c6982d  # pinned SHA
      with:
        python-version: "3.10"

    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt || true

    - name: Prepare project
      run: |
        # 압축 풀기
        unzip -o trend4t_fix_full.zip -d .
        unzip -o ETHUSDT_1min_2020_2025.zip -d data || mkdir -p data
        mv ETHUSDT_1min_2020_2025.csv data/ || true
        mkdir -p _out_4t/github

    - name: Run backtest
      run: |
        python run_4t.py \
          --train_start 2025-01-01 --train_end 2025-04-30 \
          --test_start 2025-05-01 --test_end 2025-06-30 \
          --data data/ETHUSDT_1min_2020_2025.csv \
          --outdir _out_4t/github

    - name: Upload results
      uses: actions/upload-artifact@c7d193f32edcb7bfad88892161225aeda64e9392  # pinned SHA
      with:
        name: backtest-results
        path: |
          _out_4t/github/**
          **/train_test_summary*.json
          **/logs/**
