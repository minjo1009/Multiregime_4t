name: 4t-backtest

on:
  workflow_dispatch:

jobs:
  backtest:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      - name: Run backtest
        run: |
          set -euxo pipefail
          OUT_DIR=_out_4t/github
          mkdir -p $OUT_DIR
          python run_4t.py \
            --data data/ETHUSDT_1min_2020_2025.csv \
            --train_start 2025-01-01 \
            --train_end 2025-04-30 \
            --test_start 2025-05-01 \
            --test_end 2025-06-30 \
            --H 5 \
            --out_dir $OUT_DIR | tee $OUT_DIR/run.log

      - name: Upload artifacts
        uses: actions/upload-artifact@v4
        with:
          name: backtest-results
          path: |
            _out_4t/github/**
            **/train_test_summary*.json
            **/logs/**
